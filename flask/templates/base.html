<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RAFT Election Algorithm</title>
    <meta name="author" content="Samuel Catania, Joud El-Shawa, Ian Prentice, Meg Zhang">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/list-groups.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
{% include 'header.html' %}
{% block content %}
{% endblock %}
<script>
    document.getElementById('add-server').addEventListener('click', function () {
        fetch('/load-server-content')
            .then(response => response.json())
            .then(data => {
                const contentArea = document.getElementById('content-area');
                const noServersText = document.getElementById('no-servers');

                // Create a new div for each instance
                const div = document.createElement('div');
                div.className = 'server-instance';
                div.innerHTML = data.html;

                // Append the new div to the content area
                contentArea.appendChild(div);

                // Hide the 'no servers' text if it's visible
                if (noServersText) {
                    noServersText.style.display = 'none';
                }

                // Add event listener to the new "Remove" button within this div
                div.querySelector('.remove-btn').addEventListener('click', function () {
                    div.remove(); // This will remove the specific div
                    // Check if there are no more servers, and show the 'no servers' text if true
                    if (contentArea.getElementsByClassName('server-instance').length === 0) {
                        noServersText.style.display = 'block';
                    }
                });
            });
    });

    // Initial check to see if the 'no servers' text should be displayed
    document.addEventListener('DOMContentLoaded', function () {
        const contentArea = document.getElementById('content-area');
        const noServersText = document.getElementById('no-servers');
        if (contentArea.getElementsByClassName('server-instance').length === 0) {
            noServersText.style.display = 'block';
        } else {
            noServersText.style.display = 'none';
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const toggle = document.getElementById('toggleServer');
        const confirmToggleOff = document.getElementById('confirmToggleOff');
        const serverStatus = document.getElementById('server-status');
        const inputField = document.getElementById('inputField');
        const addServer = document.getElementById('add-server');
        let lastCheckedState = toggle.checked;  // Store the initial state of the checkbox

        // Set initial disabled state based on the toggle's initial state
        if (!toggle.checked) {
            inputField.disabled = true;
            addServer.disabled = true;
            serverStatus.textContent = 'Manager Process Is Not Running';
            serverStatus.className = 'text-danger';
        } else {
            inputField.disabled = false;
            addServer.disabled = false;
            serverStatus.textContent = 'Manager Process Is Running';
            serverStatus.className = 'text-success';
        }

        toggle.addEventListener('click', function (event) {
            if (toggle.checked !== lastCheckedState) {  // Check if the state has changed
                if (!toggle.checked) {  // If trying to turn off
                    event.preventDefault();  // Prevent the toggle
                    var modal = new bootstrap.Modal(document.getElementById('confirmationModal'));
                    modal.show();
                } else {
                    // Handle other logic for turning on if necessary
                    lastCheckedState = toggle.checked;
                    serverStatus.textContent = 'Manager Process Is Running';
                    serverStatus.className = 'text-success';
                    inputField.disabled = false;
                    addServer.disabled = false;
                }
            }
        });

        // Handle confirmation from the modal
        confirmToggleOff.addEventListener('click', function () {
            lastCheckedState = false;  // Update the stored state to reflect the change
            toggle.checked = false;  // Now allow the toggle to turn off
            serverStatus.textContent = 'Manager Process Is Not Running';
            serverStatus.className = 'text-danger';
            inputField.disabled = true;
            addServer.disabled = true;
            var modal = bootstrap.Modal.getInstance(document.getElementById('confirmationModal'));
            modal.hide(); // Hide the modal
        });
    });
</script>
<script>
    let lastClickedRadio = null;  // Store the last clicked radio

    function toggleRadio(radio, serverId) {
        let lastClickedRadio = window[`lastClickedRadio_${serverId}`]; // Use a dynamic property to track the last clicked radio
        let serverLog = document.getElementById(`server-log_${serverId}`);

        if (radio === lastClickedRadio) {
            radio.checked = false;
            radio.blur();
            serverLog.style.display = 'none';  // Hide the server log textarea when no radio is selected
            window[`lastClickedRadio_${serverId}`] = null;
        } else {
            if (lastClickedRadio) {
                lastClickedRadio.blur();
            }
            window[`lastClickedRadio_${serverId}`] = radio;
            radio.checked = true;
            serverLog.style.display = 'block';  // Show the server log textarea when a radio is selected
            updateLogContent(radio, serverId);  // Pass the server ID to updateLogContent
        }
    }

    function updateLogContent(radio, serverId) {
        let serverLog = document.getElementById(`server-log_${serverId}`);
        switch (radio.id) {
            case `listGroupRadioGrid1_${serverId}`:
                serverLog.value = 'Details for Server Logs...';
                break;
            case `listGroupRadioGrid2_${serverId}`:
                serverLog.value = 'Details for Heartbeat Log...';
                break;
            case `listGroupRadioGrid3_${serverId}`:
                serverLog.value = 'Details for Output Log...';
                break;
            default:
                serverLog.value = '';
        }
    }

    // Initial state setup for the textarea
    document.addEventListener('DOMContentLoaded', function () {
        let serverLog = document.getElementById('server-log');
        let radios = document.querySelectorAll('input[type="radio"][name="listGroupRadioGrid"]');
        let anyChecked = Array.from(radios).some(radio => radio.checked);

        serverLog.style.display = anyChecked ? 'block' : 'none';  // Initial display based on radio state
        if (anyChecked) {
            let checkedRadio = Array.from(radios).find(radio => radio.checked);
            updateLogContent(checkedRadio);  // Initialize content if there's a checked radio
        }
    });

</script>

{% include 'modal.html' %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>
{% include 'footer.html' %}